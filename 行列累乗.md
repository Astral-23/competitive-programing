# 遷移行列によるdpの計算
dpの状態数を $k$ とする。  
dpの遷移が線形漸化式の形をしている時、  

$M := k \times k$行列  
$a := k \times 1$行列

に対し、  
$M[to\_state][pre\_state] := pre\_stateからto\_stateへの遷移の係数$
$a[state] := dp[state]の初期値$

として

$$ M^{遷移の回数} \times a$$

とすると、dpが計算できる。

# tips
## 遷移が線形漸化式ではあるが、その遷移の種類が複数ある時の遷移行列
- 単にdpをしても計算できるが、上の考えを用いるとdp全体の遷移行列を計算できる
    - 遷移の種類それぞれに対し遷移行列を用意した後、次に実行すべき遷移に対応する遷移行列をかけていけば、dp全体に対する遷移行列を計算できる
    - わざわざdpしてから遷移行列を計算し直すよりも実装が楽
    - [提出例](https://atcoder.jp/contests/abc200/submissions/60925356)


## より一般に、半環なら行列累乗できる
- + と * を別の演算に置き換えた形の漸化式が経っていれば、同様に「かけると遷移になる式」になる
- その +, * が条件を満たすと powを使ってよくなる（交換則だっけ）
    - 特に単位元の存在と値、分配法則を見ると良い
- [参考](https://atcoder.jp/contests/abc236/editorial/3286)
    - 0, 1にはそれぞれ 0_R, 1_Rを入れれば良い
    - 半環...加法の逆元がない。代わりに、 any * 0 = 0 となる。

## 1遷移がモノイドの演算で表せればセグ木に乗る
1遷移がモノイドの演算で表せるということは、結合則が（モノイドなんだから）成立していて、セグ木に載せられる
- 特に、（全ての種類の）１遷移だけ計算できれば良い。
- [dpの遷移をモノイド（特に: 行列は表現力が高い）の演算で表す](https://yukicoder.me/problems/no/2762)
    - dpの遷移...テーブルに対して、prefix sumを足していく
    - 1遷移に必要な情報を考察すると、dpテーブル自体の保持は必要なくて、(1)ans (2)最後の0からのprefix sum (3) 最後の1からのprefix sum さえ保持できていれば遷移できる
    - 0の遷移も1の遷移も行列で書ける -> セグ木に載せて終わり

### 分割統治ができればセグ木に乗る
ほとんど同じことを言っている。しかし、[0, m)*[m, n)を統合するのと [0, m) * m を統合するのでは後者の方が楽であるし、何より「1回の遷移を表すことさえできれば乗る」ということが後者の方がわかりやすい。
